namespace DiagnPortal.API.Data
{
    public static class CustomSqlQueries
    {
        private const string InitialDateForDataRetrieval = @"'2022-01-01'";
        private const string _SqlQueryMain =
                @$"SELECT * FROM (
SELECT 
		 PF.PATCODE, PF.PATLAST, PF.PATFIRST, PH.PATFATHER, PF.PATBIRTH, PF.PATSEX, 
         PX.PATDATE, PX.PATTIME, '' AS EXHEADER, '' AS EXHEADERNAME, X.EXCODE AS EXCODE, X.EXNAME AS EXNAME, PX.APOTEL AS APOTEL,
         'ml' AS UNITS ,
         PFS1.FYS AS NORMALVALUES, 
         PX.PATHOL AS ABNORMALSTATUS,
		 PX.PARDATE as PARADOSH,
		 PX.SAMPLEDATE as DEIGMADATE,
		 CONCAT(PM.SXOL1, PM.SXOL2) AS COMMENTBYTEST, PX.CNCODE, X.EXKATHG, DF.DCODE, DF.DLAST+' '+DF.DFIRST AS DNAME
         , NULL AS EXHEADERNAMELATIN
         , X.EXLATNAME AS EXNAMELATIN
		 , NULL AS GRPTITLE
		 , NULL AS GRPTITLEEN
		 , x.EXTMHMA
		 , FT.TNAME AS EXTNAME
		 , PX.PRNGRP
         , CASE 
			WHEN PE.PDFFILE is not NULL THEN CAST(1 AS BIT)
			ELSE CAST(0 AS BIT) 
			END AS HASFILES  
		FROM dbo.PATEXET AS PX WITH (NOLOCK)
        INNER JOIN dbo.PATVISIT AS PV WITH (NOLOCK) ON PV.PATCODE=PX.PATCODE AND PV.PATDATE=PX.PATDATE AND PV.PATTIME=PX.PATTIME AND PV.CNCODE=PX.CNCODE
        INNER JOIN dbo.EXET AS X WITH (NOLOCK) ON X.EXCODE = PX.EXCODE 
        INNER JOIN dbo.PAT1FILE AS PF WITH (NOLOCK) ON PF.PATCODE = PX.PATCODE
        INNER JOIN dbo.FTMHMA as ft WITH (NOLOCK) ON ft.TCODE = x.EXTMHMA
        LEFT JOIN dbo.PAT1HOSPFILE AS PH WITH (NOLOCK) ON PF.PATCODE = PH.PATCODE
		LEFT JOIN dbo.PATEXET2 PE WITH (NOLOCK) ON PE.PATCODE = PX.PATCODE AND PE.PATDATE = PX.PATDATE AND PE.PATTIME = PX.PATTIME AND PE.EXCODE = PX.EXCODE 
        LEFT JOIN dbo.PATEXMEMO PM WITH (NOLOCK) ON PM.PATCODE = PX.PATCODE AND PM.PATDATE = PX.PATDATE AND PM.PATTIME = PX.PATTIME AND PM.EXCODE = PX.EXCODE         
		LEFT JOIN dbo.PATEXFYS PFS1 WITH (NOLOCK) ON PFS1.PATCODE = PX.PATCODE AND PFS1.PATDATE = PX.PATDATE AND PFS1.PATTIME = PX.PATTIME AND PFS1.EXHEADER = PX.EXCODE AND PFS1.EXCODE = PX.EXCODE         
		LEFT JOIN dbo.DOCTFILE DF WITH (NOLOCK) ON DF.DCODE=PV.PARAP1        
WHERE   
(PX.STATUS > 1) AND (PX.PATDATE > {InitialDateForDataRetrieval}) and x.EXKATHG in (1)
UNION 
SELECT 
		 PF.PATCODE, PF.PATLAST, PF.PATFIRST, PH.PATFATHER, PF.PATBIRTH, PF.PATSEX, 
         PX.PATDATE, PX.PATTIME, ISNULL(PX.EXCODE,'') AS EXHEADER, X.EXNAME AS EXHEADERNAME, ISNULL(XX.EXCODE,X.EXCODE) AS EXCODE, ISNULL(XX.EXNAME,X.EXNAME) AS EXNAME, ISNULL(PX1.APOTEL, PX.APOTEL) AS APOTEL,
         'ml' AS UNITS ,
         PFS1.FYS AS NORMALVALUES, 
         PX1.PATHOL AS ABNORMALSTATUS,
		 PX.PARDATE as PARADOSH,
		 PX.SAMPLEDATE as DEIGMADATE,
		 CONCAT(PM.SXOL1, PM.SXOL2) AS COMMENTBYTEST, PX.CNCODE, X.EXKATHG, DF.DCODE, DF.DLAST+' '+DF.DFIRST AS DNAME
         , X.EXLATNAME AS EXHEADERNAMELATIN
         , XX.EXLATNAME AS EXNAMELATIN
		 , EP.TITLE AS SUBTITLE
		 , EP.TITLEEN AS SUBTITLEEN
		 , X.EXTMHMA
		 , FT.TNAME AS EXTNAME
		 , PX1.PRNGRP
		 ,CASE 
		WHEN PE.CHART1FILE is not NULL THEN CAST(1 AS BIT) 
		WHEN PE.PDFFILE is not NULL THEN CAST(1 AS BIT) 
		ELSE CAST(0 AS BIT) END 
		AS HASFILES
		FROM dbo.PATEXET AS PX WITH (NOLOCK)
        INNER JOIN dbo.PATEXET1 AS PX1 WITH (NOLOCK) ON PX.PATCODE = PX1.PATCODE AND PX.PATDATE = PX1.PATDATE AND PX.PATTIME = PX1.PATTIME AND PX.EXCODE = PX1.EXHEADER
        INNER JOIN dbo.PATVISIT AS PV WITH (NOLOCK) ON PV.PATCODE=PX.PATCODE AND PV.PATDATE=PX.PATDATE AND PV.PATTIME=PX.PATTIME AND PV.CNCODE=PX.CNCODE
        INNER JOIN dbo.EXET AS X WITH (NOLOCK) ON X.EXCODE = PX.EXCODE
        INNER JOIN dbo.EXET AS XX WITH (NOLOCK) ON XX.EXCODE = PX1.EXCODE		
        INNER JOIN dbo.PAT1FILE AS PF WITH (NOLOCK) ON PF.PATCODE = PX.PATCODE
        INNER JOIN dbo.FTMHMA as ft WITH (NOLOCK) ON ft.TCODE = x.EXTMHMA
		LEFT JOIN dbo.EXPACK as EP WITH (NOLOCK) ON XX.EXCODE = EP.EXCODE AND X.EXCODE = EP.EXPCODE
        LEFT JOIN dbo.PAT1HOSPFILE AS PH WITH (NOLOCK) ON PF.PATCODE = PH.PATCODE
        LEFT JOIN dbo.PATEXMEMO PM WITH (NOLOCK) ON PM.PATCODE = PX.PATCODE AND PM.PATDATE = PX.PATDATE AND PM.PATTIME = PX.PATTIME AND PM.EXCODE = PX.EXCODE 
		LEFT JOIN dbo.PATEXET2 PE WITH (NOLOCK) ON PE.PATCODE = PX.PATCODE AND PE.PATDATE = PX.PATDATE AND PE.PATTIME = PX.PATTIME AND PE.EXCODE = PX.EXCODE 
        LEFT JOIN dbo.PATEXFYS PFS1 ON PFS1.PATCODE = PX.PATCODE AND PFS1.PATDATE = PX.PATDATE AND PFS1.PATTIME = PX.PATTIME AND PFS1.EXHEADER = PX1.EXHEADER AND PFS1.EXCODE = PX1.EXCODE
        LEFT JOIN dbo.DOCTFILE DF WITH (NOLOCK) ON DF.DCODE=PV.PARAP1
        WHERE
				(PX.STATUS > 1) AND (PX.PATDATE > {InitialDateForDataRetrieval}) and x.EXKATHG in (3)
		) AS L 
		";

        private static string _SqlWhereClause { get; set; } =
            @"WHERE PATCODE = @PATCODE and PATDATE = @PATDATE and PATTIME = @PATTIME
";
        private static string _SqlWhereClause2 { get; set; } =
            @"WHERE PATCODE = @PATCODE and PATDATE = @PATDATE
";

        private static string _SqlOrderBy { get; set; } = @"ORDER BY 1, 7, 9, 24";

        public static string GetSqlQueryPatcodePatdatePattime => $"{_SqlQueryMain}{_SqlWhereClause}{_SqlOrderBy}";
        public static string GetSqlQueryPatcodePatdate => $"{_SqlQueryMain}{_SqlWhereClause2}{_SqlOrderBy}";
    }
}
